(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6619],{4959:(e,t,s)=>{Promise.resolve().then(s.bind(s,2361))},2361:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>b});var a=s(5155),r=s(2115),i=s(1812),l=s(3561),n=s(6329),o=s(7530),d=s(4505),c=s(3473),u=s(747),x=s(4912),m=s(767),v=s(5686),f=s(7780);function h(e){let{isOpen:t,onClose:s,linkToEdit:i,onSuccess:l}=e,[n,o]=(0,r.useState)(""),[c,h]=(0,r.useState)(""),[p,b]=(0,r.useState)(!1),{user:g}=(0,x.A)(),y=(0,u.U)();(0,r.useEffect)(()=>{i?(o(i.title),h(i.url)):(o(""),h(""))},[i,t]);let j=async e=>{if(e.preventDefault(),g){b(!0);try{if(null==i?void 0:i.id){let{error:e}=await y.from("links").update({title:n,url:c}).eq("id",i.id);if(e)throw e}else{var t,a;let{data:e}=await y.from("links").select("display_order").eq("profile_id",g.id).order("display_order",{ascending:!1}).limit(1),s=(null!==(a=null==e?void 0:null===(t=e[0])||void 0===t?void 0:t.display_order)&&void 0!==a?a:0)+1,{error:r}=await y.from("links").insert({profile_id:g.id,title:n,url:c,is_active:!0,display_order:s});if(r)throw r}l(),s()}catch(e){console.error("Error saving link:",e),alert("Erro ao salvar link. Tente novamente.")}finally{b(!1)}}},N=async()=>{if((null==i?void 0:i.id)&&confirm("Tem certeza que deseja excluir este link?")){b(!0);try{let{error:e}=await y.from("links").delete().eq("id",i.id);if(e)throw e;l(),s()}catch(e){console.error("Error deleting link:",e),alert("Erro ao excluir link.")}finally{b(!1)}}};return t?(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:(0,a.jsxs)("div",{className:"w-full max-w-md bg-vasta-surface rounded-2xl border border-vasta-border shadow-2xl p-6 animate-in zoom-in-95 duration-200",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-vasta-text",children:i?"Editar Link":"Novo Link"}),(0,a.jsx)("button",{onClick:s,className:"text-vasta-muted hover:text-vasta-text transition-colors",children:(0,a.jsx)(m.A,{size:20})})]}),(0,a.jsxs)("form",{onSubmit:j,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-semibold text-vasta-muted uppercase mb-1.5",children:"T\xedtulo"}),(0,a.jsx)("input",{type:"text",required:!0,placeholder:"Ex: Meu Portf\xf3lio",value:n,onChange:e=>o(e.target.value),className:"w-full rounded-xl border border-vasta-border bg-vasta-surface-soft px-4 py-3 text-sm text-vasta-text focus:border-vasta-primary focus:ring-1 focus:ring-vasta-primary outline-none transition-all"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-semibold text-vasta-muted uppercase mb-1.5",children:"URL"}),(0,a.jsx)("input",{type:"url",required:!0,placeholder:"https://...",value:c,onChange:e=>h(e.target.value),className:"w-full rounded-xl border border-vasta-border bg-vasta-surface-soft px-4 py-3 text-sm text-vasta-text focus:border-vasta-primary focus:ring-1 focus:ring-vasta-primary outline-none transition-all"})]}),(0,a.jsxs)("div",{className:"flex gap-3 pt-4",children:[i&&(0,a.jsxs)("button",{type:"button",onClick:N,disabled:p,className:"flex-1 flex items-center justify-center gap-2 rounded-xl border border-red-500/20 bg-red-500/10 text-red-500 py-3 text-sm font-bold hover:bg-red-500/20 transition-all disabled:opacity-50",children:[(0,a.jsx)(v.A,{size:18}),"Excluir"]}),(0,a.jsx)("button",{type:"submit",disabled:p,className:"flex-[2] flex items-center justify-center gap-2 rounded-xl bg-vasta-primary text-white py-3 text-sm font-bold hover:bg-vasta-primary-soft transition-all shadow-lg shadow-vasta-primary/20 disabled:opacity-50",children:p?(0,a.jsx)(d.A,{className:"animate-spin"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f.A,{size:18})," Salvar"]})})]})]})]})}):null}function p(e){let{link:t,toggleActive:s,onEdit:r}=e,{attributes:i,listeners:d,setNodeRef:c,transform:u,transition:x,isDragging:m}=(0,l.gl)({id:t.id}),v={transform:n.Ks.Transform.toString(u),transition:x,zIndex:m?20:1};return(0,a.jsxs)("div",{ref:c,style:v,className:"group flex items-center gap-3 rounded-2xl border border-vasta-border bg-vasta-surface/50 p-4 transition-all hover:bg-vasta-surface ".concat(m?"shadow-2xl brightness-110 scale-[1.02]":"shadow-sm"," ").concat(t.is_active?"":"opacity-60 grayscale-[0.5] hover:opacity-100 hover:grayscale-0"),children:[(0,a.jsx)("div",{...i,...d,className:"cursor-grab text-vasta-muted transition-colors hover:text-vasta-text p-2 -ml-2 rounded-lg hover:bg-vasta-surface-soft",children:(0,a.jsx)(o.A,{size:20})}),(0,a.jsxs)("div",{className:"flex-1 space-y-0.5 min-w-0",children:[(0,a.jsx)("div",{className:"font-semibold text-vasta-text truncate",children:t.title}),(0,a.jsx)("div",{className:"text-xs text-vasta-muted truncate",children:t.url})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 sm:gap-4 shrink-0",children:[(0,a.jsx)("button",{onClick:()=>r(t),className:"rounded-lg bg-vasta-surface-soft px-3 py-1.5 text-xs font-medium text-vasta-text transition-colors hover:bg-vasta-border",children:"Editar"}),(0,a.jsx)("button",{onClick:()=>s(t.id,t.is_active),className:"relative h-6 w-11 rounded-full p-1 transition-colors ".concat(t.is_active?"bg-emerald-500":"bg-vasta-muted/30"),children:(0,a.jsx)("div",{className:"h-4 w-4 rounded-full bg-white shadow-sm transition-transform ".concat(t.is_active?"translate-x-5":"translate-x-0")})})]})]})}function b(){let{user:e}=(0,x.A)(),[t,s]=(0,r.useState)([]),[n,o]=(0,r.useState)(!0),[m,v]=(0,r.useState)(!1),[f,b]=(0,r.useState)(null),g=(0,u.U)(),y=(0,i.FR)((0,i.MS)(i.AN),(0,i.MS)(i.uN,{coordinateGetter:l.JR})),j=async()=>{if(!e)return;let{data:t}=await g.from("links").select("*").eq("profile_id",e.id).order("display_order",{ascending:!0});t&&s(t),o(!1)};(0,r.useEffect)(()=>{j()},[e]);let N=async(e,t)=>{s(s=>s.map(s=>s.id===e?{...s,is_active:!t}:s)),await g.from("links").update({is_active:!t}).eq("id",e)},w=async e=>{let{active:t,over:a}=e;t.id!==(null==a?void 0:a.id)&&s(e=>{let s=e.findIndex(e=>e.id===t.id),r=e.findIndex(e=>e.id===(null==a?void 0:a.id)),i=(0,l.be)(e,s,r);return i.map((e,t)=>({id:e.id,display_order:t})).forEach(e=>{g.from("links").update({display_order:e.display_order}).eq("id",e.id).then()}),i})},k=()=>{b(null),v(!0)},_=e=>{b(e),v(!0)};return n?(0,a.jsx)("div",{className:"flex h-64 items-center justify-center",children:(0,a.jsx)(d.A,{className:"animate-spin text-vasta-primary"})}):(0,a.jsxs)("div",{className:"mx-auto max-w-4xl space-y-8 pb-32 animate-in fade-in duration-500",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-vasta-text",children:"Meus links"}),(0,a.jsx)("p",{className:"text-sm text-vasta-muted",children:"Organize e gerencie seus links p\xfablicos"})]}),(0,a.jsxs)("button",{onClick:k,className:"flex items-center justify-center gap-2 rounded-2xl bg-vasta-primary px-6 py-3 text-sm font-bold text-white transition-all hover:bg-vasta-primary-soft shadow-lg shadow-vasta-primary/20 hover:scale-105 active:scale-95",children:[(0,a.jsx)(c.A,{size:18})," Adicionar novo link"]})]}),(0,a.jsxs)("div",{className:"flex gap-2 p-1 bg-vasta-surface-soft/50 rounded-2xl w-fit",children:[(0,a.jsxs)("button",{className:"rounded-xl px-4 py-2 text-sm font-medium bg-vasta-surface text-vasta-text shadow-sm transition-all border border-vasta-border",children:["Todos (",t.length,")"]}),(0,a.jsxs)("button",{className:"rounded-xl px-4 py-2 text-sm font-medium text-vasta-muted hover:text-vasta-text transition-all",children:["Ativos (",t.filter(e=>e.is_active).length,")"]})]}),(0,a.jsx)(i.Mp,{sensors:y,collisionDetection:i.fp,onDragEnd:w,children:(0,a.jsx)("div",{className:"grid gap-4",children:(0,a.jsx)(l.gB,{items:t.map(e=>e.id),strategy:l._G,children:t.map(e=>(0,a.jsx)(p,{link:e,toggleActive:N,onEdit:_},e.id))})})}),0===t.length&&(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center rounded-3xl border border-dashed border-vasta-border py-20 text-center bg-vasta-surface/30",children:[(0,a.jsx)("div",{className:"h-16 w-16 rounded-full bg-vasta-surface-soft flex items-center justify-center mb-4 text-vasta-muted",children:(0,a.jsx)(c.A,{size:32})}),(0,a.jsx)("h3",{className:"font-bold text-vasta-text mb-1",children:"Crie seu primeiro link"}),(0,a.jsx)("p",{className:"text-sm text-vasta-muted max-w-xs mx-auto mb-6",children:"Compartilhe seu Instagram, LinkedIn, loja ou qualquer outro site."}),(0,a.jsx)("button",{onClick:k,className:"text-sm font-bold text-vasta-primary hover:underline",children:"Adicionar link agora"})]}),(0,a.jsx)(h,{isOpen:m,onClose:()=>v(!1),linkToEdit:f,onSuccess:j})]})}},4912:(e,t,s)=>{"use strict";s.d(t,{A:()=>o,AuthProvider:()=>n});var a=s(5155),r=s(2115),i=s(747);let l=(0,r.createContext)(void 0);function n(e){let{children:t}=e,[s,n]=(0,r.useState)(!1),[o,d]=(0,r.useState)("signup"),[c,u]=(0,r.useState)(void 0),[x,m]=(0,r.useState)(null),[v,f]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{let e=(0,i.U)();e.auth.getUser().then(e=>{let{data:{user:t}}=e;m(t),f(!1)});let{data:{subscription:t}}=e.auth.onAuthStateChange((e,t)=>{var s;m(null!==(s=null==t?void 0:t.user)&&void 0!==s?s:null),f(!1)});return()=>{t.unsubscribe()}},[]),(0,a.jsx)(l.Provider,{value:{openAuthModal:(e,t)=>{d(e),u(t),n(!0)},closeAuthModal:()=>n(!1),isOpen:s,mode:o,contextualCTA:c,user:x,loading:v},children:t})}function o(){let e=(0,r.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},747:(e,t,s)=>{"use strict";let a;s.d(t,{U:()=>d});var r=s(5352),i=s(2818);let l=i.env.NEXT_PUBLIC_SUPABASE_URL,n=i.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,o=()=>{if(!l||!n)throw Error("[Security] Missing Supabase environment variables. Ensure NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY are set.")};function d(){return a||(o(),a=(0,r.UU)(l||"https://placeholder.supabase.co",n||"placeholder-key",{auth:{persistSession:!0,storageKey:"vasta-auth-token",storage:window.localStorage,detectSessionInUrl:!1,flowType:"pkce",autoRefreshToken:!0}}))}}},e=>{var t=t=>e(e.s=t);e.O(0,[5352,6834,8441,1517,7358],()=>t(4959)),_N_E=e.O()}]);