"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8190],{8190:(e,t,a)=>{a.r(t),a.d(t,{default:()=>U,useAppearance:()=>_,useConfirm:()=>S});var s=a(5155),r=a(2115),l=a(8173),o=a.n(l),i=a(6046),n=a(858),d=a(4113),c=a(2316),x=a(5870),m=a(9136),u=a(5236),h=a(98),f=a(767),v=a(8251),b=a(1466),p=a(5800),g=a(8236),j=a(6233),N=a(6710),y=a(747),w=a(4912);function k(e){let{children:t}=e,{user:a,loading:l}=(0,w.A)(),o=(0,i.useRouter)(),n=(0,i.usePathname)();return((0,r.useEffect)(()=>{l||a||o.push("/login?next=".concat(encodeURIComponent(n)))},[a,l,o,n]),l)?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:"Carregando..."}):a?(0,s.jsx)(s.Fragment,{children:t}):null}let C=(0,r.createContext)(void 0),_=()=>{let e=(0,r.useContext)(C);if(!e)throw Error("useAppearance must be used within AppearanceProvider");return e},A=(0,r.createContext)(void 0),S=()=>{let e=(0,r.useContext)(A);if(!e)throw Error("useConfirm must be used within Layout");return e},I=[{href:"/dashboard",label:"In\xedcio",icon:n.A,exact:!0},{href:"/dashboard/links",label:"Links",icon:d.A,exact:!1},{href:"/dashboard/aparencia",label:"Apar\xeancia",icon:c.A,exact:!1},{href:"/dashboard/minha-loja",label:"Minha Loja",icon:x.A,exact:!1},{href:"/dashboard/vendas",label:"Vendas",icon:m.A,exact:!1}];function E(e){let{href:t,label:a,icon:r,exact:l}=e,n=(0,i.usePathname)(),d=l?n===t:n.startsWith(t);return(0,s.jsxs)(o(),{href:t,className:"group flex items-center gap-3 rounded-xl px-3 py-2.5 text-sm transition-all duration-200 ".concat(d?"bg-vasta-primary/10 text-vasta-primary font-bold shadow-sm":"text-vasta-muted hover:bg-vasta-surface-soft hover:text-vasta-text"),children:[(0,s.jsx)(r,{className:"h-4 w-4 transition-colors ".concat(d?"text-vasta-primary":"text-vasta-muted group-hover:text-vasta-text")}),(0,s.jsx)("span",{children:a}),d&&(0,s.jsx)("div",{className:"ml-auto h-1.5 w-1.5 rounded-full bg-vasta-primary shadow-sm"})]})}function U(e){let{children:t}=e,{user:a}=(0,w.A)(),l=(0,y.U)(),n=(0,i.useRouter)(),[d,c]=(0,r.useState)(!1),[x,m]=(0,r.useState)(!1),[_,S]=(0,r.useState)(!1),[U,z]=(0,r.useState)(null),F=e=>{z(e),S(!0)},[L,B]=(0,r.useState)({profileImage:null,coverImage:null,coverImageCredit:null,accentColor:"#6366F1",bgColor:null,typography:"Inter",linkStyle:"glass",theme:"adaptive",username:"seunome",bio:"Sua bio inspiradora"});(0,r.useEffect)(()=>{!async function(){if(!a)return;let{data:e,error:t}=await l.from("profiles").select("*").eq("id",a.id).maybeSingle();t&&console.error("Error fetching profile:",t),e?B({profileImage:e.profile_image,coverImage:e.cover_image,coverImageCredit:e.cover_image_credit||null,accentColor:e.accent_color||"#6366F1",bgColor:e.bg_color,typography:e.typography||"Inter",linkStyle:e.link_style||"glass",theme:e.theme||"adaptive",username:e.username||"seunome",bio:e.bio||""}):console.warn("No profile found for user, using defaults.")}()},[a]);let T=async e=>{if(console.log("updateSettings called with:",e),B(t=>({...t,...e})),!a){console.error("User not found in updateSettings, skipping DB update");return}let t={};void 0!==e.profileImage&&(t.profile_image=e.profileImage),void 0!==e.coverImage&&(t.cover_image=e.coverImage),void 0!==e.coverImageCredit&&(t.cover_image_credit=e.coverImageCredit),void 0!==e.accentColor&&(t.accent_color=e.accentColor),void 0!==e.bgColor&&(t.bg_color=e.bgColor),void 0!==e.typography&&(t.typography=e.typography),void 0!==e.linkStyle&&(t.link_style=e.linkStyle),void 0!==e.theme&&(t.theme=e.theme),void 0!==e.username&&(t.username=e.username),void 0!==e.bio&&(t.bio=e.bio);let{error:s}=await l.from("profiles").upsert({id:a.id,updated_at:new Date,...t});s?(console.error("Error updating profile:",s),F({title:"Erro ao salvar",description:"N\xe3o foi poss\xedvel salvar as altera\xe7\xf5es. Detalhes: ".concat(s.message),variant:"danger",confirmText:"OK",onConfirm:()=>{}})):console.log("Profile updated successfully",t)};return(0,s.jsx)(k,{children:(0,s.jsx)(C.Provider,{value:{settings:L,updateSettings:T},children:(0,s.jsx)(A.Provider,{value:{confirm:F},children:(0,s.jsxs)("div",{className:"flex h-screen bg-vasta-bg text-vasta-text overflow-hidden",children:[_&&U&&(0,s.jsx)("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/80 p-4 backdrop-blur-sm animate-in fade-in duration-200",children:(0,s.jsx)("div",{className:"w-full max-w-sm rounded-[2rem] bg-vasta-surface border border-vasta-border shadow-2xl overflow-hidden scale-100 animate-in zoom-in-95 duration-200",children:(0,s.jsxs)("div",{className:"p-6 text-center space-y-4",children:[(0,s.jsx)("div",{className:"mx-auto h-12 w-12 rounded-full flex items-center justify-center ".concat("danger"===U.variant?"bg-red-500/10 text-red-500":"bg-vasta-primary/10 text-vasta-primary"),children:"danger"===U.variant?(0,s.jsx)(u.A,{size:24}):(0,s.jsx)(h.A,{size:24})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-vasta-text",children:U.title}),(0,s.jsx)("p",{className:"text-sm text-vasta-muted mt-2",children:U.description})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3 pt-2",children:[(0,s.jsx)("button",{onClick:()=>S(!1),className:"py-3 rounded-xl font-bold text-sm border border-vasta-border text-vasta-text hover:bg-vasta-surface-soft transition-colors",children:U.cancelText||"Cancelar"}),(0,s.jsx)("button",{onClick:()=>{null==U||U.onConfirm(),S(!1)},className:"py-3 rounded-xl font-bold text-sm text-white shadow-lg transition-all ".concat("danger"===U.variant?"bg-red-500 hover:bg-red-600 shadow-red-500/20":"bg-vasta-primary hover:bg-vasta-primary-soft shadow-vasta-primary/20"),children:U.confirmText||"Confirmar"})]})]})})}),d&&(0,s.jsx)("div",{className:"fixed inset-0 z-40 bg-black/60 backdrop-blur-sm md:hidden",onClick:()=>c(!1)}),(0,s.jsxs)("aside",{className:"fixed inset-y-0 left-0 z-50 flex w-64 flex-col border-r border-vasta-border bg-vasta-surface transition-transform duration-300 md:relative md:translate-x-0 ".concat(d?"translate-x-0":"-translate-x-full"),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-4 py-4",children:[(0,s.jsxs)(o(),{href:"/dashboard",className:"flex items-center justify-start",children:[(0,s.jsx)("img",{src:"/logo.svg",alt:"Vasta Logo",className:"w-32 h-auto dark:hidden"}),(0,s.jsx)("img",{src:"/logo_branca.svg",alt:"Vasta Logo",className:"w-32 h-auto hidden dark:block"})]}),(0,s.jsx)("button",{className:"text-vasta-muted hover:text-vasta-text md:hidden",onClick:()=>c(!1),children:(0,s.jsx)(f.A,{className:"h-5 w-5"})})]}),(0,s.jsx)("div",{className:"px-4",children:(0,s.jsxs)("div",{className:"rounded-2xl bg-vasta-surface-soft p-4 text-xs border border-vasta-border/50",children:[(0,s.jsx)("div",{className:"text-vasta-muted font-medium",children:"Seu link"}),(0,s.jsxs)("div",{className:"mt-1 text-sm font-bold text-vasta-text",children:["@",L.username]}),(0,s.jsx)("a",{href:"/".concat(L.username),target:"_blank",rel:"noopener noreferrer",className:"mt-3 block text-center w-full rounded-full bg-vasta-bg border border-vasta-border py-1.5 text-xs font-medium text-vasta-text hover:bg-vasta-border/50 transition-colors",children:"Ver p\xe1gina p\xfablica"}),(0,s.jsx)("button",{onClick:()=>{navigator.clipboard.writeText("https://vasta.pro/".concat(L.username))},className:"mt-2 w-full rounded-full bg-gradient-to-r from-vasta-primary to-vasta-accent py-1.5 text-xs font-bold text-white shadow-md shadow-vasta-primary/20 hover:shadow-lg transition-all",children:"Copiar link"})]})}),(0,s.jsxs)("nav",{className:"mt-6 flex flex-1 flex-col gap-1 px-4 text-sm",children:[I.map(e=>(0,s.jsx)(E,{href:e.href,label:e.label,icon:e.icon,exact:e.exact},e.href)),(0,s.jsx)("div",{className:"my-2 h-px bg-vasta-border/50 mx-2"}),(0,s.jsx)(E,{href:"/",label:"Voltar para o site",icon:v.A})]}),(0,s.jsx)("div",{className:"border-t border-vasta-border p-3",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("button",{onClick:()=>m(!x),className:"flex w-full items-center justify-between rounded-xl p-2 transition-all hover:bg-vasta-surface-soft ".concat(x?"bg-vasta-surface-soft":""),children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 overflow-hidden text-left",children:[(0,s.jsx)("div",{className:"flex h-9 w-9 shrink-0 items-center justify-center rounded-full bg-gradient-to-br from-vasta-primary to-violet-600 text-white shadow-md",children:(0,s.jsx)(b.A,{size:16})}),(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsxs)("p",{className:"truncate text-sm font-bold text-vasta-text",children:["@",L.username]}),(0,s.jsx)("p",{className:"truncate text-[10px] text-vasta-muted",children:"Plano Free"})]})]}),(0,s.jsx)(p.A,{className:"h-4 w-4 text-vasta-muted"})]}),x&&(0,s.jsxs)("div",{className:"absolute bottom-full left-0 mb-2 w-full min-w-[240px] origin-bottom rounded-2xl border border-vasta-border bg-vasta-surface p-1.5 shadow-xl animate-in fade-in slide-in-from-bottom-2 z-50",children:[(0,s.jsxs)("div",{className:"mb-1 px-2 py-1.5",children:[(0,s.jsx)("p",{className:"text-xs font-bold text-vasta-text",children:"Minha Conta"}),(0,s.jsx)("p",{className:"text-[10px] text-vasta-muted truncate",children:null==a?void 0:a.email})]}),(0,s.jsxs)("div",{className:"space-y-0.5",children:[(0,s.jsxs)(o(),{href:"/dashboard/settings",className:"flex w-full items-center gap-2 rounded-lg px-2 py-2 text-xs font-medium text-vasta-text hover:bg-vasta-surface-soft transition-colors",onClick:()=>m(!1),children:[(0,s.jsx)(g.A,{size:14,className:"text-vasta-muted"}),"Configura\xe7\xf5es"]}),(0,s.jsxs)(o(),{href:"/dashboard/billing",className:"flex w-full items-center gap-2 rounded-lg px-2 py-2 text-xs font-medium text-vasta-text hover:bg-vasta-surface-soft transition-colors",onClick:()=>m(!1),children:[(0,s.jsx)(j.A,{size:14,className:"text-vasta-muted"}),"Assinatura e Cobran\xe7a"]}),(0,s.jsx)("div",{className:"my-1 h-px bg-vasta-border/50"}),(0,s.jsxs)("button",{className:"group flex w-full items-center gap-2 rounded-lg bg-gradient-to-r from-vasta-text to-stone-800 px-2 py-2 text-xs font-bold text-vasta-bg shadow-sm transition-all hover:opacity-90",children:[(0,s.jsx)(h.A,{size:14,className:"text-amber-300"}),"Fazer Upgrade"]}),(0,s.jsx)("div",{className:"my-1 h-px bg-vasta-border/50"}),(0,s.jsxs)("button",{onClick:async()=>{await l.auth.signOut(),n.push("/")},className:"flex w-full items-center gap-2 rounded-lg px-2 py-2 text-xs font-medium text-red-500 hover:bg-red-500/10 transition-colors",children:[(0,s.jsx)(u.A,{size:14}),"Sair da conta"]})]})]})]})})]}),(0,s.jsxs)("div",{className:"flex flex-1 flex-col min-w-0 bg-vasta-bg",children:[(0,s.jsxs)("header",{className:"flex items-center justify-between border-b border-vasta-border bg-vasta-surface/80 backdrop-blur-md px-4 py-3 md:px-6 z-30",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("button",{className:"text-vasta-muted hover:text-vasta-text md:hidden",onClick:()=>c(!0),children:(0,s.jsx)(N.A,{className:"h-6 w-6"})}),(0,s.jsx)("div",{className:"text-sm font-bold text-vasta-text",children:"Dashboard"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3 text-xs",children:[(0,s.jsx)("span",{className:"hidden sm:inline-block rounded-full bg-emerald-500/10 px-2.5 py-1 text-emerald-600 dark:text-emerald-400 font-medium border border-emerald-500/20",children:"Pagamentos ativos"}),(0,s.jsxs)("a",{href:"/".concat(L.username),target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 rounded-full bg-vasta-surface-soft border border-vasta-border px-3 py-1 text-vasta-text hover:bg-vasta-border/50 transition-colors",children:[(0,s.jsx)("span",{className:"h-2 w-2 rounded-full bg-emerald-500"}),(0,s.jsxs)("span",{className:"hidden sm:inline font-medium",children:["vasta.pro/",L.username]}),(0,s.jsx)(v.A,{size:12,className:"opacity-50"})]})]})]}),(0,s.jsxs)("main",{className:"flex flex-1 overflow-hidden relative",children:[(0,s.jsx)("div",{className:"flex-1 overflow-y-auto px-4 py-6 md:px-8 custom-scrollbar",children:t}),(0,s.jsxs)("aside",{className:"hidden w-80 border-l border-vasta-border bg-vasta-surface-soft/30 px-6 py-8 xl:block overflow-y-auto custom-scrollbar",children:[(0,s.jsx)("div",{className:"text-xs font-bold uppercase tracking-wider text-vasta-muted mb-6",children:"Preview ao vivo"}),(0,s.jsx)(P,{settings:L})]})]})]})]})})})})}function P(e){let{settings:t}=e,{user:a}=(0,w.A)(),l=(0,y.U)(),[o,i]=(0,r.useState)([]),[n,d]=(0,r.useState)([]),[c,x]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{async function e(){if(!a)return;let{data:e}=await l.from("links").select("*").eq("profile_id",a.id).eq("is_active",!0).order("display_order",{ascending:!0});e&&i(e);let{data:t}=await l.from("products").select("*").eq("profile_id",a.id).eq("status","active").order("created_at",{ascending:!1}).limit(4);t&&d(t),x(!1)}e();let t=l.channel("preview-updates").on("postgres_changes",{event:"*",schema:"public",table:"links",filter:"profile_id=eq.".concat(null==a?void 0:a.id)},()=>e()).on("postgres_changes",{event:"*",schema:"public",table:"products",filter:"profile_id=eq.".concat(null==a?void 0:a.id)},()=>e()).subscribe();return()=>{l.removeChannel(t)}},[a]),(0,s.jsx)("div",{className:"flex justify-center sticky top-0",children:(0,s.jsxs)("div",{className:"relative h-[600px] w-[300px] rounded-[3.5rem] border-8 border-vasta-surface shadow-2xl overflow-hidden transition-all duration-500 overflow-y-auto custom-scrollbar",style:{fontFamily:t.typography,backgroundColor:t.bgColor||("light"===t.theme?"#FAFAF9":"#0B0E14"),color:"light"===t.theme?"#1C1917":"#F3F4F6"},children:[(0,s.jsxs)("div",{className:"absolute top-0 left-0 right-0 h-32 bg-vasta-surface-soft overflow-hidden shrink-0",children:[t.coverImage?(0,s.jsx)("img",{src:t.coverImage,className:"h-full w-full object-cover",alt:"Cover"}):(0,s.jsx)("div",{className:"h-full w-full bg-gradient-to-br from-vasta-primary/20 to-vasta-accent/20"}),(0,s.jsx)("div",{className:"absolute inset-0 bg-black/10"}),t.coverImageCredit&&(0,s.jsxs)("div",{className:"absolute bottom-2 right-2 px-1.5 py-0.5 bg-black/20 backdrop-blur-md rounded text-[7px] text-white/50 pointer-events-none",children:["@",t.coverImageCredit.includes(":")?t.coverImageCredit.split(":")[1]:t.coverImageCredit]})]}),(0,s.jsxs)("div",{className:"relative z-10 p-4 flex flex-col items-center pt-20",children:[(0,s.jsx)("div",{className:"h-24 w-24 rounded-full border-4 shadow-xl overflow-hidden shrink-0",style:{borderColor:t.bgColor||("light"===t.theme?"#FAFAF9":"#0B0E14")},children:t.profileImage?(0,s.jsx)("img",{src:t.profileImage,className:"h-full w-full object-cover",alt:"Avatar"}):(0,s.jsx)("div",{className:"flex h-full items-center justify-center bg-gradient-to-tr from-vasta-primary to-vasta-accent",children:(0,s.jsx)("span",{className:"text-xl font-bold text-white uppercase",children:t.username.slice(0,2)})})}),(0,s.jsxs)("div",{className:"text-center mt-3 mb-6",children:[(0,s.jsxs)("h2",{className:"text-base font-bold",children:["@",t.username]}),(0,s.jsx)("p",{className:"text-[10px] opacity-60 mt-1 max-w-[200px] leading-relaxed",children:t.bio})]}),(0,s.jsxs)("div",{className:"w-full space-y-3 px-2",children:[o.map(e=>(0,s.jsxs)("div",{className:"group relative flex items-center justify-center p-3 rounded-2xl transition-all shadow-sm overflow-hidden cursor-default",style:{..."solid"===t.linkStyle?{backgroundColor:t.accentColor,color:"#fff"}:{},..."outline"===t.linkStyle?{border:"2px solid ".concat(t.accentColor),color:t.accentColor}:{},..."glass"===t.linkStyle?{backgroundColor:"light"===t.theme?"rgba(0,0,0,0.05)":"rgba(255,255,255,0.1)",backdropFilter:"blur(10px)",border:"1px solid rgba(255,255,255,0.1)"}:{},...["solid","outline"].includes(t.linkStyle)||"glass"===t.linkStyle?{}:{backgroundColor:t.accentColor,color:"#fff"}},children:[(0,s.jsx)("div",{className:"relative z-10 text-center text-xs font-bold truncate px-6",children:e.title}),("solid"===t.linkStyle||"glass"===t.linkStyle)&&(0,s.jsx)("div",{className:"absolute inset-0 translate-x-[-100%] group-hover:animate-[shine_1s_infinite] bg-gradient-to-r from-transparent via-white/20 to-transparent"})]},e.id)),0===o.length&&!c&&(0,s.jsx)("div",{className:"text-center py-4 opacity-50 text-[10px] uppercase font-bold tracking-widest",children:"Sem links"})]}),n.length>0&&(0,s.jsxs)("div",{className:"w-full mt-8 px-2",children:[(0,s.jsx)("h3",{className:"text-center text-[10px] font-bold uppercase tracking-widest opacity-50 mb-3 font-sans",children:"Loja"}),(0,s.jsx)("div",{className:"grid gap-3",children:n.map(e=>(0,s.jsx)("div",{className:"relative overflow-hidden rounded-[1.25rem] bg-black/5 dark:bg-white/5 border border-black/5 dark:border-white/10 group cursor-default",children:(0,s.jsxs)("div",{className:"flex h-16",children:[e.image_url&&(0,s.jsx)("div",{className:"w-16 h-full shrink-0 bg-black/5",children:(0,s.jsx)("img",{src:e.image_url,className:"w-full h-full object-cover",alt:e.title})}),(0,s.jsxs)("div",{className:"p-3 flex flex-col justify-center flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"font-bold text-xs truncate leading-tight",children:e.title}),(0,s.jsx)("div",{className:"mt-1 flex items-center justify-between",children:(0,s.jsx)("span",{className:"font-bold text-emerald-600 dark:text-emerald-400 bg-emerald-500/10 px-1.5 py-0.5 rounded text-[10px]",children:e.price>0?"R$ ".concat(e.price.toFixed(2).replace(".",",")):"Gr\xe1tis"})})]})]})},e.id))})]})]}),(0,s.jsx)("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 h-6 w-24 bg-vasta-surface rounded-b-3xl z-50 shadow-inner"})]})})}},4912:(e,t,a)=>{a.d(t,{A:()=>n,AuthProvider:()=>i});var s=a(5155),r=a(2115),l=a(747);let o=(0,r.createContext)(void 0);function i(e){let{children:t}=e,[a,i]=(0,r.useState)(!1),[n,d]=(0,r.useState)("signup"),[c,x]=(0,r.useState)(void 0),[m,u]=(0,r.useState)(null),[h,f]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{let e=(0,l.U)();e.auth.getUser().then(e=>{let{data:{user:t}}=e;u(t),f(!1)});let{data:{subscription:t}}=e.auth.onAuthStateChange((e,t)=>{var a;u(null!==(a=null==t?void 0:t.user)&&void 0!==a?a:null),f(!1)});return()=>{t.unsubscribe()}},[]),(0,s.jsx)(o.Provider,{value:{openAuthModal:(e,t)=>{d(e),x(t),i(!0)},closeAuthModal:()=>i(!1),isOpen:a,mode:n,contextualCTA:c,user:m,loading:h},children:t})}function n(){let e=(0,r.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},747:(e,t,a)=>{let s;a.d(t,{U:()=>d});var r=a(5352),l=a(2818);let o=l.env.NEXT_PUBLIC_SUPABASE_URL,i=l.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,n=()=>{if(!o||!i)throw Error("[Security] Missing Supabase environment variables. Ensure NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY are set.")};function d(){return s||(n(),s=(0,r.UU)(o||"https://placeholder.supabase.co",i||"placeholder-key",{auth:{persistSession:!0,storageKey:"vasta-auth-token",storage:window.localStorage,detectSessionInUrl:!1,flowType:"pkce",autoRefreshToken:!0}}))}}}]);